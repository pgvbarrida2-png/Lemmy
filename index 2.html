<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy 27th Birthday üíñ</title>
<style>
  :root{
    --bg:#0b0f1a;
    --card:#0f1724;
    --accent:#ff5c8a;
    --text:#fff;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial}
  body{
    background: radial-gradient(ellipse at bottom, #0b1220 0%, #06111b 60%), #020416;
    color:var(--text);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
  }

  .stage{
    width:min(980px,96%);
    height:640px;
    border-radius:14px;
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    position:relative;
    overflow:hidden;
    box-shadow: 0 12px 40px rgba(4,6,12,0.7);
  }

  header{
    position:absolute;
    left:18px;
    top:16px;
    z-index:40;
    display:flex;
    gap:12px;
    align-items:center;
  }
  .avatar{
    width:56px;height:56px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#ff9ec4);
    display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:20px;
    box-shadow:0 8px 20px rgba(255,92,138,0.12);
  }
  h1{margin:0;font-size:18px}
  .sub{color:rgba(255,255,255,0.75);font-size:13px;margin-top:4px}

  /* controls */
  .controls{
    position:absolute;right:18px;top:16px;z-index:40;display:flex;gap:8px;
  }
  .btn{background:rgba(255,255,255,0.06);border:0;padding:10px 12px;border-radius:10px;color:var(--text);cursor:pointer;font-weight:700}
  .btn-pink{background:linear-gradient(90deg,var(--accent),#ff819f);color:#fff}
  .btn-soft{background:rgba(255,255,255,0.04);}

  /* center message */
  .center{
    position:absolute;left:0;right:0;top:50%;transform:translateY(-50%);z-index:30;text-align:center;padding:0 24px;
  }
  .greet{font-size:40px;font-weight:800;letter-spacing:-1px;margin-bottom:8px}
  .greet small{display:block;font-size:18px;font-weight:600;color:rgba(255,255,255,0.85);margin-top:8px}

  /* fireworks canvas */
  canvas#fx { position:absolute; inset:0; z-index:10; pointer-events:none; }

  /* letter modal */
  .modal{
    position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:50;
    background:linear-gradient(rgba(2,4,8,0.6),rgba(2,4,8,0.6));
    padding:20px;
  }
  .letter{
    width:min(760px,94%);max-height:90%;overflow:auto;background:linear-gradient(180deg,#fff,#fff6f2);
    color:#121212;border-radius:12px;padding:26px;box-shadow:0 18px 40px rgba(3,6,12,0.6);position:relative;
    transform:translateY(6px);animation:pop .36s ease;
  }
  @keyframes pop{from{transform:translateY(18px) scale(.98);opacity:0}to{transform:none;opacity:1}}

  .letter h2{margin-top:0;color:#ff4d93}
  .letter p{line-height:1.5;font-size:16px}
  .close{position:absolute;right:12px;top:12px;border:0;background:transparent;font-weight:800;font-size:18px;cursor:pointer}

  footer{position:absolute;left:18px;bottom:14px;z-index:40;color:rgba(255,255,255,0.8);font-size:13px}

  .hint{font-size:12px;color:rgba(255,255,255,0.65);margin-top:6px}

  /* small responsive */
  @media (max-width:640px){
    .greet{font-size:28px}
    .letter{padding:18px}
  }
</style>
</head>
<body>
  <div class="stage" role="main" aria-label="Birthday Stage">
    <canvas id="fx"></canvas>

    <header>
      <div class="avatar">27</div>
      <div>
        <h1>Happy Birthday ‚Äî Lemuel</h1>
        <div class="sub">Nov 28 ¬∑ Age 27</div>
      </div>
    </header>

    <div class="controls">
      <button id="openLetter" class="btn btn-pink">Open Letter ‚úâÔ∏è</button>
      <button id="playSong" class="btn btn-soft">Play Song ‚ñ∂Ô∏è</button>
      <button id="fireworksBtn" class="btn btn-soft">Light Fireworks üéÜ</button>
    </div>

    <div class="center" aria-hidden="true">
      <div class="greet">üéâ Happy 27th, my love!</div>
      <small class="sub">Click "Open Letter" to show your surprise ‚Äî and don't forget the fireworks!</small>
    </div>

    <footer>
      From: <strong>Pearl</strong>
      <div class="hint">Tip: Open the letter. Then press "Light Fireworks" while the song plays for full effect ‚ú®</div>
    </footer>

    <!-- letter modal (hidden by default) -->
    <div id="modal" class="modal" style="display:none" role="dialog" aria-modal="true" aria-label="Birthday Letter">
      <div class="letter">
        <button class="close" id="closeModal">‚úï</button>
        <h2>To my dearest Lemuel,</h2>
        <p>Happy 27th birthday, my everything. Each year with you feels like a roll of beautiful film‚Äîslightly grainy, endlessly warm, and full of perfect little moments. You are kind, silly, brave, and the coziest person I‚Äôve ever known.</p>
        <p>Today I want you to stop worrying about everything else and just feel loved. I hope this letter, a song, and a sky full of fireworks remind you of how much you mean to me.</p>
        <p>Make a wish, blow the candles, and let's promise to keep exploring the world (and film stores) together. I love you more than words, more than film, more than late-night snacks. Forever,</p>
        <p style="margin-top:18px;font-weight:700">‚Äî Pearl üíï</p>
      </div>
    </div>

  </div>

<script>
/* --- Fireworks animation on canvas --- */
(function(){
  const canvas = document.getElementById('fx');
  const ctx = canvas.getContext('2d');
  let W, H, particles = [];

  function resize(){ 
    W = canvas.width = canvas.offsetWidth;
    H = canvas.height = canvas.offsetHeight;
  }
  window.addEventListener('resize', resize);
  resize();

  function rand(a,b){ return Math.random()*(b-a)+a; }
  function hue(){ return Math.floor(rand(0,360)); }

  class Particle {
    constructor(x,y, hue, speed, angle, decay, colorStops){
      this.x = x; this.y = y;
      this.h = hue;
      this.speed = speed;
      this.angle = angle;
      this.vx = Math.cos(angle)*speed;
      this.vy = Math.sin(angle)*speed;
      this.life = 0;
      this.decay = decay;
      this.alpha = 1;
      this.size = rand(1.5,3.8);
      this.colorStops = colorStops;
    }
    update(dt){
      this.vy += 0.02*dt; // gravity subtle
      this.x += this.vx * dt;
      this.y += this.vy * dt;
      this.vx *= 0.995;
      this.vy *= 0.995;
      this.life += dt;
      this.alpha = Math.max(0, 1 - (this.life/this.decay));
    }
    draw(){
      const g = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size*6);
      g.addColorStop(0, `hsla(${this.h},90%,65%,${this.alpha})`);
      g.addColorStop(1, `hsla(${this.h},70%,55%,0)`);
      ctx.fillStyle = g;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size*1.8, 0, Math.PI*2);
      ctx.fill();
    }
  }

  function explode(x,y, hueBase){
    const count = Math.floor(rand(30,80));
    const speedBase = rand(2,5);
    const decay = rand(40,120);
    for(let i=0;i<count;i++){
      const angle = rand(0, Math.PI*2);
      const speed = speedBase * rand(0.4,1.8);
      particles.push(new Particle(x,y, hueBase + rand(-20,20), speed, angle, decay));
    }
  }

  let last = performance.now();
  function loop(now){
    const dt = (now - last) * 0.06; // scaled delta
    last = now;

    // clear with slight fade for trails
    ctx.fillStyle = 'rgba(3,6,12,0.2)';
    ctx.fillRect(0,0,W,H);

    // update & draw particles
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.update(dt);
      p.draw();
      if(p.alpha <= 0.02 || p.y > H + 50 || p.x < -50 || p.x > W+50){
        particles.splice(i,1);
      }
    }
    requestAnimationFrame(loop);
  }
  loop(performance.now());

  // public trigger
  window.triggerFirework = function(normalizedX){
    const x = normalizedX ? normalizedX * W : rand(W*0.2, W*0.8);
    const y = rand(H*0.08, H*0.5);
    explode(x,y, hue());
  };

  // also allow button to trigger multiple bursts
  document.getElementById('fireworksBtn').addEventListener('click', function(){
    // create a small show
    for(let i=0;i<6;i++){
      setTimeout(()=> triggerFirework(), i*240);
    }
  });

  // click on stage to burst
  document.querySelector('.stage').addEventListener('click', function(e){
    // prevent when clicking UI buttons
    const rect = this.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const nx = x / rect.width;
    triggerFirework(nx);
  });
})();

/* --- Modal letter logic --- */
const modal = document.getElementById('modal');
const openLetter = document.getElementById('openLetter');
const closeModal = document.getElementById('closeModal');

openLetter.addEventListener('click', ()=> {
  modal.style.display = 'flex';
  // when letter opens, play song and light a few fireworks
  playBirthdaySong();
  for(let i=0;i<8;i++){
    setTimeout(()=> window.triggerFirework(), i*300);
  }
});

closeModal.addEventListener('click', ()=> {
  modal.style.display = 'none';
});

/* --- Simple birthday song via WebAudio --- */
let audioCtx = null;
function playBirthdaySong(){
  try {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state === 'suspended') audioCtx.resume();
    const now = audioCtx.currentTime;

    // notes (frequency in Hz) and durations
    const notes = [
      [392, 0.28],[392,0.28],[440,0.56],[392,0.56],[523.25,0.56],[440,1.12],
      [392,0.28],[392,0.28],[440,0.56],[392,0.56],[587.33,0.56],[523.25,1.12],
      [392,0.28],[392,0.28],[784,0.56],[659.25,0.56],[523.25,0.56],[440,0.56],[392,0.56],[0,0.28],[659.25,0.28],
      [659.25,0.28],[659.25,0.56],[587.33,0.56],[523.25,0.56],[440,1.12]
    ];

    let t = now + 0.05;
    for(const [freq,dur] of notes){
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'triangle';
      o.frequency.setValueAtTime(freq || 1, t);
      g.gain.setValueAtTime(0, t);
      g.gain.linearRampToValueAtTime(0.14, t + 0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, t + dur);
      o.connect(g); g.connect(audioCtx.destination);
      o.start(t); o.stop(t + dur + 0.02);
      t += dur;
    }
  } catch (err) {
    console.warn('Audio not supported', err);
  }
}

/* --- Small UX: play button --- */
document.getElementById('playSong').addEventListener('click', ()=> {
  playBirthdaySong();
});

/* --- Auto-open modal if user wants when page loads (optional) --- */
window.addEventListener('load', ()=> {
  // don't force; leave closed so user can click. But we can show a gentle nudge.
  // setTimeout(()=>{ /* modal.style.display='flex'; playBirthdaySong(); */ }, 1200);
});
</script>
</body>
</html>
